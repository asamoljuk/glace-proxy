<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"baseProxy.js.html":{"id":"baseProxy.js.html","title":"Source: baseProxy.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: baseProxy.js &quot;use strict&quot;; /** * Base proxy. * * @module */ var _ = require(&quot;lodash&quot;); var U = require(&quot;glacejs-utils&quot;); /** * Base proxy. * * @class * @abstract * @arg {object} [opts] - Options. * @arg {?number} [opts.speed=null] - Proxy speed, kb/s. * @arg {boolean} [opts.useCache=false] - Flag to use cache middleware. * @arg {number} [opts.reconnect=0] - Number of times reconnect to remote * side, if it breaks connection. * @arg {timeout} [opts.timeout=60000] - Time to wait remote side response, ms. * @arg {port} [opts.port=0] - Port. Default is random. */ var BaseProxy = module.exports = function (opts) { this.isRunning = false; this.speed = U.defVal(opts.speed); this.responsesData = null; this.useCache = U.defVal(opts.useCache, false); this._reconnect = U.defVal(opts.reconnect, 0); this._timeout = U.defVal(opts.timeout, 60000); this._port = U.defVal(opts.port, 0); this._proxy = null; }; /** * Sets speed of responses from proxy to client. * * @method * @arg {number} speed - Proxy responses speed. kb/s. */ BaseProxy.prototype.setSpeed = function (speed) { this.speed = speed; }; /** * Resets speed of responses. * * @method */ BaseProxy.prototype.resetSpeed = function () { this.speed = null; }; /** * Starts to measure responses and gather information of them. * * @method */ BaseProxy.prototype.measureResponses = function () { this.responsesData = []; }; /** * Disables responses measurement. * * @method */ BaseProxy.prototype.unmeasureResponses = function () { this.responsesData = null; }; /** * Gets responses data. * * @method */ BaseProxy.prototype.getResponsesData = function () { if (this.responsesData === null) return null; return _.cloneDeep(this.responsesData); }; /** * Starts proxy. * * @method */ BaseProxy.prototype.start = function () { throw new Error(&quot;Should be implemented in derived class&quot;); }; /** * Stops proxy server. * * @method */ BaseProxy.prototype.stop = function () { throw new Error(&quot;Should be implemented in derived class&quot;); }; × Search results Close "},"cli.js.html":{"id":"cli.js.html","title":"Source: cli.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: cli.js &quot;use strict&quot;; /** * `GlaceJS` proxy runner. * * @module */ require(&quot;vorpal&quot;); require(&quot;colors&quot;); // should be required after `vorpal` only. require(&quot;./help&quot;); var U = require(&quot;glacejs-utils&quot;); var Commands = require(&quot;./commands&quot;); var CONF = require(&quot;./config&quot;); var interactive = require(&quot;./interactive&quot;); /** * Proxy runner. * * @function */ module.exports.run = () =&gt; { var cmd = new Commands(CONF, { logger: console.log, colored: true }); Promise .resolve() .then(() =&gt; { if (CONF.proxy.global) return cmd.launchGlobalProxy(); }) .then(() =&gt; { if (CONF.proxy.http) cmd.launchHttpProxy(); }) .then(() =&gt; { if (CONF.chrome.launch) return cmd.launchChrome(); }) .then(() =&gt; interactive(cmd)) .catch(e =&gt; U.exit(&quot;Promise error&quot;)); }; process.on(&quot;uncaughtException&quot;, U.exit(&quot;Uncaught Exception&quot;)); process.on(&quot;unhandledRejection&quot;, U.exit(&quot;Unhandled Rejection&quot;)); × Search results Close "},"commands.js.html":{"id":"commands.js.html","title":"Source: commands.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: commands.js &quot;use strict&quot;; /** * Commands to manage `GlaceJS` proxy. * * @module */ var fs = require(&quot;fs&quot;); var http = require(&quot;http&quot;); var os = require(&quot;os&quot;); var path = require(&quot;path&quot;); require(&quot;colors&quot;); var _ = require(&quot;lodash&quot;); var chromeLauncher = require(&quot;chrome-launcher&quot;); var expect = require(&quot;chai&quot;).expect; var fse = require(&quot;fs-extra&quot;); var isRunning = require(&quot;is-running&quot;); var temp = require(&quot;temp&quot;).track(); var U = require(&quot;glacejs-utils&quot;); var cache = require(&quot;./middleware/cache&quot;); var GlobalProxy = require(&quot;./globalProxy&quot;); var HttpProxy = require(&quot;./httpProxy&quot;); var logger = require(&quot;./logger&quot;); /** * Creates commands instance. * * @class * @arg {object} config - Commands config. * @arg {object} [opts] - Commands options. * @arg {function} [opts.logger] - Commands logger. Default is system logger. * @arg {boolean} [opts.colored=false] - Flag to use ANSI color in log message. */ var Commands = module.exports = function (config, opts) { this._config = config; opts = U.defVal(opts, {}); this._log = U.defVal(opts.logger, logger.info.bind(logger)); this._coloredLog = U.defVal(opts.colored, false); this._chrome = null; this._httpProxy = null; this._globalProxy = null; }; /** * Command to launch HTTP proxy. * * @async * @method * @return {Promise&lt;boolean&gt;} - `true` if HTTP proxy was launched. `false` if * command can't be executed. Causes to not launch HTTP proxy: * - HTTP proxy is launched already. * - Proxied URL isn't specified. */ Commands.prototype.launchHttpProxy = async function () { if (this._httpProxy &amp;&amp; this._httpProxy.isRunning) { var msg = &quot;HTTP proxy is launched already&quot;; if (this._coloredLog) msg = msg.red; this._log(msg); return false; }; if (!this._config.url) { var msg = &quot;Proxied URL isn't specified&quot;; if (this._coloredLog) msg = msg.red; this._log(msg); return false; }; this._httpProxy = new HttpProxy({ port: this._config.proxy.port, timeout: this._config.proxy.timeout, reconnect: this._config.proxy.reconnect, useCache: this._config.cache.use, url: this._config.url, speed: this._config.proxy.speed, }); return this._httpProxy .start() .then(() =&gt; { if (this._coloredLog) { var msg = `HTTP proxy is started on host ${U.hostname.cyan} ` + `and port ${this._httpProxy._port.toString().yellow}`; } else { var msg = `HTTP proxy is started on host '${U.hostname}' and ` + `port '${this._httpProxy._port}'`; }; this._log(msg); return true; }); }; /** * Command to stop HTTP proxy. * * @async * @method * @return {Promise&lt;boolean&gt;} - `true` if HTTP proxy was stopped. `false` if * command can't be executed. Causes to not stop HTTP proxy: * - HTTP proxy isn't launched yet. */ Commands.prototype.stopHttpProxy = async function () { if (!this._checkProxy()) return false; this._httpProxy.stop(); this._httpProxy = null; return true; }; /** * Command to restart HTTP proxy. * * @async * @method * @return {Promise&lt;boolean&gt;} - `true` if HTTP proxy was restarted. `false` if * command can't be executed. Causes to not restart HTTP proxy are the same as * for command to launch HTTP proxy. */ Commands.prototype.restartHttpProxy = async function() { return this.stopHttpProxy().then(() =&gt; this.launchHttpProxy()); }; /** * Command to launch global transparent proxy. * * @async * @method * @return {Promise&lt;boolean&gt;} - `true` if global transparent proxy isn't * launched. `false` if command can't be executed. Causes to not launch * global transparent proxy: * - Global transparent proxy is launched already. */ Commands.prototype.launchGlobalProxy = function () { if (this._globalProxy &amp;&amp; this._globalProxy.isRunning) { var msg = &quot;Global transparent proxy is launched already&quot;; if (this._coloredLog) msg = msg.red; this._log(msg); return false; }; this._globalProxy = new GlobalProxy({ port: this._config.proxy.globalPort, timeout: this._config.proxy.timeout, reconnect: this._config.proxy.reconnect, installCertificate: this._config.installCertificate, rootPath: this._config.rootPath, useCache: this._config.cache.use, speed: this._config.speed, }); return this._globalProxy .start() .then(() =&gt; { if (this._coloredLog) { var msg = `Global transparent proxy is started on ` + `${U.hostname.cyan} and port ` + `${this._config.proxy.globalPort.toString().yellow}`; } else { var msg = `Global transparent proxy is started on host ` + `'${U.hostname}' and port '${this._config.proxy.globalPort}'`; }; this._log(msg); return true; }); }; /** * Command to stop global transparent proxy. * * @async * @method * @return {Promise&lt;boolean&gt;} - `true` if global transparent proxy was stopped. * `false` if command can't be executed. Causes to not stop global transparent * proxy: * - Global transparent proxy isn't launched yet. */ Commands.prototype.stopGlobalProxy = async function () { if (this._globalProxy &amp;&amp; this._globalProxy.isRunning) { var msg = &quot;Global transparent proxy isn't launched yet&quot;; if (this._coloredLog) msg = msg.red; this._log(msg); return false; }; this._globalProxy.stop(); this._globalProxy = null; return true; }; /** * Command to restart global transparent proxy. * * @async * @method * @return {Promise&lt;boolean&gt;} - `true` if global transparent proxy was restarted. * `false` if command can't be executed. Causes to not restart global * transparent proxy are the same as for command to launch global * transparent proxy. */ Commands.prototype.restartGlobalProxy = async function() { return this.stopGlobalProxy().then(() =&gt; this.launchGlobalProxy()); }; /** * Command to launch chrome browser. * * @async * @method * @return {Promise&lt;boolean&gt;} - `true` if chrome browser was launched. `false` * if command can't be executed. Causes to not launch chrome browser: * - HTTP proxy isn't launched yet. * - Chrome browser is launched already. */ Commands.prototype.launchChrome = async function () { if (this._isChromeLaunched()) { var msg = &quot;Chrome browser is launched already&quot;; if (this._coloredLog) msg = msg.red; this._log(msg); return false; }; var chromeFlags = [ &quot;--start-maximized&quot;, &quot;--disable-infobars&quot;, &quot;--enable-precise-memory-info&quot;, &quot;--disable-translate&quot;, ]; if (this._config.chrome.incognito) { chromeFlags.push(&quot;--incognito&quot;); }; if (this._config.proxy.global) { chromeFlags = chromeFlags.concat([ &quot;--ignore-certificate-errors&quot;, `--proxy-server=${U.hostname}:${this._config.proxy.globalPort}`, `--proxy-bypass-list=localhost,127.0.0.1,${U.hostname}`, ]); }; var profileDir = temp.path(); fse.mkdirsSync(profileDir); return chromeLauncher.launch({ startingUrl: this._proxy ? this._proxy.url : this._config.url, userDataDir: profileDir, chromeFlags: chromeFlags, handleSIGINT: true, }).then(chrome =&gt; { this._chrome = chrome; if (this._coloredLog) { var msg = `Chrome is launched with PID ` + `${chrome.pid.toString().yellow}`; } else { var msg = `Chrome is launched with PID '${chrome.pid}'`; } this._log(msg); logger.info(&quot;Chrome PID&quot;, chrome.pid); logger.info(&quot;Chrome debugging port&quot;, chrome.port); logger.info(&quot;Chrome profile&quot;, profileDir); return true; }); }; /** * Command to close chrome browser. * * @async * @method * @return {Promise&lt;boolean&gt;} - `true` if chrome browser was closed. `false` if * command can't be executed. Causes to not close chrome browser: * - Chrome browser isn't launched yet. */ Commands.prototype.closeChrome = async function () { if (!this._isChromeLaunched()) { var msg = &quot;Chrome browser isn't launched yet&quot;; if (this._coloredLog) msg = msg.red; this._log(msg); return false; }; this._chrome.kill(); this._chrome = null; return true; }; /** * Command to restart chrome browser. * * @async * @method * @return {Promise&lt;boolean&gt;} - `true` if chrome browser was restarted. `false` * if command can't be executed. Causes to not restart chrome browser are the * the same as for command to launch chrome browser. */ Commands.prototype.restartChrome = async function () { return this.closeChrome().then(() =&gt; this.launchChrome()); }; /** * Command to set proxy speed. * * @async * @method * @arg {number} speed - Proxy speed, kb/s. * @return {Promise&lt;boolean&gt;} - `true` if proxy speed was set. `false` if * command can't be executed. Causes to not set proxy speed: * - HTTP proxy isn't launched. */ Commands.prototype.setProxySpeed = async function (speed) { if (!this._checkProxy()) return false; if (this._globalProxy) { this._globalProxy.setSpeed(speed); }; this._httpProxy.setSpeed(speed); return true; }; /** * Command to reset proxy speed. * * @async * @method * @return {Promise&lt;boolean&gt;} - `true` if proxy speed was reset. `false` if * command can't be executed. Causes to not reset proxy speed: * - HTTP proxy isn't launched. */ Commands.prototype.resetProxySpeed = async function () { if (!this._checkProxy()) return false; if (this._globalProxy) { this._globalProxy.resetSpeed(); }; this._httpProxy.resetSpeed(); return true; }; /** * Command to enable proxy cache. * * @async * @method * @return {Promise&lt;boolean&gt;} - `true` if proxy cache wasn't enabled. `false` if * command can't be executed. Causes to not enable proxy cache: * - HTTP proxy isn't launched. */ Commands.prototype.enableProxyCache = async function () { if (!this._checkProxy()) return false; if (this._globalProxy) { this._globalProxy.useCache = true; }; this._httpProxy.useCache = true; return true; }; /** * Command to disable proxy cache. * * @async * @method * @return {Promise&lt;boolean&gt;} - `true` if proxy cache wasn't disabled. `false` if * command can't be executed. Causes to not disable proxy cache: * - HTTP proxy isn't launched. */ Commands.prototype.disableProxyCache = async function () { if (!this._checkProxy()) return false; if (this._globalProxy) { this._globalProxy.useCache = false; }; this._httpProxy.useCache = false; return true; }; /** * Command to clear proxy cache. * * @async * @method * @return {Promise} */ Commands.prototype.clearProxyCache = async function () { if (fs.existsSync(this._config.cache.folder)) { fse.removeSync(this._config.cache.folder); }; await cache.init({ force: true }); }; /** * Helper to check whether proxy is launched. * * @method * @protected * @return {boolean} - `true` if proxy exists and is launched, `false` otherwise. */ Commands.prototype._checkProxy = function () { if (this._httpProxy &amp;&amp; this._httpProxy.isRunning) return true; var msg = &quot;HTTP proxy isn't launched yet&quot;; if (this._coloredLog) msg = msg.red; this._log(msg); return false; }; /** * Helper to define whether chrome is launched. * * @method * @protected */ Commands.prototype._isChromeLaunched = function () { return this._chrome &amp;&amp; isRunning(this._chrome.pid); }; × Search results Close "},"config.js.html":{"id":"config.js.html","title":"Source: config.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: config.js &quot;use strict&quot;; /** * Configures `GlaceJS` proxy before run. * * @module */ var fs = require(&quot;fs&quot;); var path = require(&quot;path&quot;); var _ = require(&quot;lodash&quot;); var argv = require(&quot;yargs&quot;).argv; var expect = require(&quot;chai&quot;).expect; var cwd = process.cwd(); /* Load CLI arguments from config */ var argsConfig = {}; var argsConfigPath = path.resolve(cwd, (argv.c || argv.config || &quot;config.json&quot;)); if (fs.existsSync(argsConfigPath)) { argsConfig = require(argsConfigPath); for (var key in argsConfig) { var val = argsConfig[key]; argsConfig[_.camelCase(key)] = val; }; }; _.mergeWith(argsConfig, argv, (objVal, srcVal) =&gt; srcVal ? srcVal : objVal); /* Set up default config */ /** * Contains `GlaceJS` proxy configuration. * * @namespace * @prop {?string} [url=null] - Proxied URL. * @prop {object} cache - Cache config. * @prop {number} [cache.ttl] - Time to life cache. Default is maximum. * @prop {number} [cache.size] - Maximum cached file size. Default is 10 GB. * @prop {boolean} [cache.use=false] - Use cache. * @prop {boolean} [cache.existing=false] - Use existing cache if exists. * @prop {boolean} [cache.folder=cwd/.proxy-cache] - Cache folder. * @prop {object} chrome - Chrome config. * @prop {boolean} [chrome.launch=false] - Launch chrome browser. * @prop {boolean} [chrome.incognito=false] - Use incognito mode in chrome. * @prop {object} log - Log config. * @prop {string} [log.level=debug] - Log level. * @prop {string} [log.path=cwd/glace-proxy.log] - Log file path. * @prop {boolean} [log.stdout=false] - Print log messages to terminal. * @prop {object} proxy - Proxy config. * @prop {number} [proxy.timeout=60000] - Proxy time to wait for remote response, ms. * @prop {number} [proxy.http=false] - Launch http proxy. * @prop {number} [proxy.port=0] - Proxy port. By default will be assigned by OS. * @prop {boolean} [proxy.global=false] - Launch global proxy. * @prop {number} [proxy.globalPort=8888] - Global proxy port. * @prop {boolean} [proxy.installCertificates] - Install global proxy certificates * as trusted. Windows only. Admin privileges are required. * @prop {number} [proxy.reconnect=2] - Number of reconnect attemptions if * remote side breaks connection. */ var config = module.exports = { cache: { ttl: Number.MAX_SAFE_INTEGER, size: 10 * 1024 * 1024 * 1024 }, chrome: { }, log: { level: &quot;debug&quot;, }, proxy: { timeout: 60000, }, }; /* Use CLI arguments */ config.url = argsConfig.url; // proxied URL config.proxy.http = !!argsConfig.httpProxy; // default is `false` config.proxy.port = argsConfig.proxyPort || 0; // default is random config.proxy.global = !!argsConfig.globalProxy; //default `false` config.proxy.globalPort = argsConfig.globalProxyPort || 8888; config.proxy.shortPort = argsConfig.shortLinkPort || 0; // default is random config.proxy.speed = argsConfig.speed; // default unlimited config.proxy.installCertificate = !!argsConfig.installCertificate; //default `false` config.proxy.reconnect = argsConfig.reconnect || 2; // TODO maybe to make as CLI option config.cache.use = !!argsConfig.cache || !!argsConfig.existingCache; // default `false` config.cache.existing = !!argsConfig.existingCache; // default `false` config.cache.folder = path.resolve(cwd, (argsConfig.cacheFolder || &quot;.proxy-cache&quot;)); config.chrome.launch = !!argsConfig.chrome; // default `false` config.chrome.incognito = !!argsConfig.chromeIncognito; // default `false` config.log.path = path.resolve(cwd, (argsConfig.log || &quot;glace-proxy.log&quot;)); config.log.stdout = !!argsConfig.stdoutLog; // default `false` × Search results Close "},"globalProxy.js.html":{"id":"globalProxy.js.html","title":"Source: globalProxy.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: globalProxy.js &quot;use strict&quot;; /** * Describes global transparent proxy. * * @module */ var fs = require(&quot;fs&quot;); var path = require(&quot;path&quot;); var util = require(&quot;util&quot;); var expect = require(&quot;chai&quot;).expect; var MitmProxy = require(&quot;http-mitm-proxy&quot;).Proxy; var spawn = require(&quot;cross-spawn&quot;); var U = require(&quot;glacejs-utils&quot;); var BaseProxy = require(&quot;./baseProxy&quot;); var cache = require(&quot;./middleware/cache&quot;); var logger = require(&quot;./logger&quot;); var middleware = require(&quot;./middleware&quot;); /** * Patch mitm proxy error processing, in order to avoid default response * finalizing on reconnect. */ var _onError = MitmProxy.prototype._onError; MitmProxy.prototype._onError = function (kind, ctx, err) { var req = ctx.clientToProxyRequest; if (req._reconnect &gt; 0 &amp;&amp; !req.socket.destroyed) { this.onErrorHandlers.forEach(function(handler) { return handler(ctx, err, kind); }); } else { _onError.apply(this, arguments); }; }; /** * Creates new instance of `GlobalProxy`. * * @class * @classdesc - Contains methods to run and manage global transparent proxy. * @arg {object} [opts] - global proxy options * @arg {number} [opts.port=8080] - global proxy port * @arg {number} [opts.timeout=0] - global proxy timeout * @arg {boolean} [opts.installCertificate=false] - flag to install global * proxy certificate as trusted in order to manage `https` connection or no * @arg {?string} [opts.rootPath] - Folder where proxy starts in order to * generate self-signed certificate. By default is `current work directory`. * @arg {boolean} [opts.useCache=false] - flag to cache and take from cache responses */ var GlobalProxy = module.exports = function (opts) { opts = U.defVal(opts, {}); BaseProxy.call(this, opts); this._installCertificate = U.defVal(opts.installCertificate, false); this._certificatePath = path.resolve(process.cwd(), &quot;.http-mitm-proxy&quot;, &quot;certs&quot;, &quot;ca.pem&quot;); this._proxy = new MitmProxy(); this._proxy.onError((ctx, err) =&gt; { var req = ctx.clientToProxyRequest; if (req._reconnect &gt; 0 &amp;&amp; !req.socket.destroyed) { logger.warn(&quot;Request reconnected&quot;, U.getReqKey(req)); req._reconnect--; this._proxy._onHttpServerRequest(ctx.isSSL, ctx.clientToProxyRequest, ctx.proxyToClientResponse); } else { logger.error(U.getReqKey(req), err); }; }); this._proxy.onRequest(async (ctx, callback) =&gt; { this.req = ctx.clientToProxyRequest; if (this.req._reconnect === undefined) { this.req._reconnect = this._reconnect; }; this.res = ctx.proxyToClientResponse; for (var mw of middleware) if (await mw.call(this)) return; delete this.req; delete this.res; return callback(); }); // TODO not sure that it works reliable this._proxy.onRequestData((ctx, chunk, callback) =&gt; { if (ctx.clientToProxyRequest.body) { chunk = new Buffer(&quot;&quot;); }; return callback(null, chunk); }); this._proxy.onResponse((ctx, callback) =&gt; { if (ctx.clientToProxyRequest.body) { ctx.proxyToServerRequest.end(ctx.clientToProxyRequest.body); }; return callback(null); }); }; util.inherits(GlobalProxy, BaseProxy); /** * Starts global proxy if it&quot;s not started yet. * * @method */ GlobalProxy.prototype.start = function () { if (this.isRunning) return; return new Promise((resolve, reject) =&gt; { this._proxy.listen({ port: this._port, silent: true, timeout: this._timeout }, err =&gt; { if (err) reject(err); resolve(); }); }).then(() =&gt; cache.init()).then(() =&gt; { this.isRunning = true; if (this._installCertificate) { if (process.platform !== &quot;win32&quot;) { throw new Error(&quot;For your platform certificate&quot; + &quot;installation isn't implemented&quot;); }; expect(fs.existsSync(this._certificatePath), `Proxy certificate ${this._certificatePath} is absent`) .to.be.true; var proc = spawn.sync(&quot;certutil&quot;, [ &quot;-addstore&quot;, &quot;-enterprise&quot;, &quot;-f&quot;, &quot;Root&quot;, this._certificatePath ]); if (proc.status !== 0) { throw new Error( &quot;Can't install proxy certificate as trusted:\\n&quot; + proc.stdout.toString()); }; }; }); }; /** * Stops global proxy if it's not stopped yet. * * @method */ GlobalProxy.prototype.stop = function () { if (!this.isRunning) return; this._proxy.close(); this.isRunning = false; }; × Search results Close "},"help.js.html":{"id":"help.js.html","title":"Source: help.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: help.js &quot;use strict&quot;; /** * Help description. * * @module */ require(&quot;colors&quot;); var U = require(&quot;glacejs-utils&quot;); var d = U.switchColor(); require(&quot;yargs&quot;) .usage(&quot;\\nglace-proxy [options]&quot;.white.bold) .options({ /* configuration */ &quot;config [config-path]&quot;: { describe: d(&quot;Path to JSON file with CLI arguments.&quot;, &quot;Default is 'cwd/config.json' (if it exists).&quot;), type: &quot;string&quot;, group: &quot;Configuration:&quot;, alias: &quot;c&quot;, }, /* proxy */ &quot;proxy-port [port-number]&quot;: { describe: d(&quot;Port for http proxy. Default is random.&quot;), type: &quot;number&quot;, group: &quot;Proxy:&quot;, }, &quot;global-proxy&quot;: { describe: d(&quot;Activate transparent global proxy.&quot;), type: &quot;boolean&quot;, group: &quot;Proxy:&quot;, }, &quot;global-proxy-port [port-number]&quot;: { describe: d(&quot;Port for transparent global proxy. Default is 8080.&quot;), type: &quot;number&quot;, group: &quot;Proxy:&quot;, }, &quot;install-certificate&quot;: { describe: d(&quot;Install global proxy certificate as trusted.&quot;, &quot;Requires administrator permissions.&quot;, &quot;Windows only.&quot;), type: &quot;boolean&quot;, group: &quot;Proxy:&quot;, }, &quot;speed &lt;value&gt;&quot;: { describe: d(&quot;Responses speed from proxy to client (browser), kb/s.&quot;, &quot;Default is unlimited.&quot;), type: &quot;number&quot;, group: &quot;Proxy:&quot;, }, /* cache */ &quot;cache&quot;: { describe: d(&quot;Cache server responses to disk.&quot;), type: &quot;boolean&quot;, group: &quot;Cache:&quot;, }, &quot;existing-cache&quot;: { describe: d(&quot;Cache server responses to disk.&quot;, &quot;Connect to existing cache if it exists.&quot;), type: &quot;boolean&quot;, group: &quot;Cache:&quot;, }, &quot;cache-folder [folder-path]&quot;: { describe: d(&quot;Folder to cache server responses.&quot;, &quot;Default is 'cwd/.proxy-cache'&quot;), type: &quot;string&quot;, group: &quot;Cache:&quot;, }, /* chrome */ &quot;chrome&quot;: { describe: d(&quot;Launch google chrome and open proxied URL there.&quot;, &quot;Pristine profile will be used.&quot;), type: &quot;boolean&quot;, group: &quot;Chrome:&quot;, }, &quot;chrome-incognito&quot;: { describe: d(&quot;Launch google chrome in incognito mode.&quot;), type: &quot;boolean&quot;, group: &quot;Chrome:&quot;, }, /* log */ &quot;log [file-path]&quot;: { describe: d(&quot;Path to log file. Default is 'cwd/glace-proxy.log'.&quot;), type: &quot;string&quot;, group: &quot;Log:&quot;, }, &quot;stdout-log&quot;: { describe: d(&quot;Print log messages to stdout.&quot;), type: &quot;boolean&quot;, group: &quot;Log:&quot;, }, }) .help(&quot;h&quot;) .alias(&quot;h&quot;, &quot;help&quot;) .argv; × Search results Close "},"httpProxy.js.html":{"id":"httpProxy.js.html","title":"Source: httpProxy.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: httpProxy.js &quot;use strict&quot;; /** * Http Proxy classes and functions. * * @module */ var fs = require(&quot;fs&quot;); var os = require(&quot;os&quot;); var http = require(&quot;http&quot;); var https = require(&quot;https&quot;); var url = require(&quot;url&quot;); var util = require(&quot;util&quot;); var path = require(&quot;path&quot;); require(&quot;colors&quot;); var _ = require(&quot;lodash&quot;); var expect = require(&quot;chai&quot;).expect; var express = require(&quot;express&quot;); var httpProxy = require(&quot;http-proxy&quot;); var U = require(&quot;glacejs-utils&quot;); var CONF = require(&quot;./config&quot;); var BaseProxy = require(&quot;./baseProxy&quot;); var cache = require(&quot;./middleware/cache&quot;); var middleware = require(&quot;./middleware&quot;); /** * Http Proxy. * * @class * @arg {object} opts - Proxy options. * @arg {string} opts.url - URL which should be proxied. * them from cache. */ var HttpProxy = module.exports = function (opts) { BaseProxy.call(this, opts); this._initUrl = opts.url; this._url = null; this._server = null; this._proxyOptions = {}; this._proxy = httpProxy.createProxyServer(); this._proxy.on('proxyReq', (proxyReq, req, res, options) =&gt; { if (req.body) proxyReq.end(req.body); }); this._proxy.on(&quot;error&quot;, (err, req, res) =&gt; { if (req._reconnect &gt; 0 &amp;&amp; !req.socket.destroyed) { logger.warn(&quot;Request reconnected&quot;, U.getReqKey(req)); req._reconnect--; this._proxy.web(req, res); } else { logger.error(U.getReqKey(req), err); }; }); this.updateOptions(); var app = express(); app.use(async (req, res) =&gt; { this.req = req; if (this.req._reconnect === undefined) { this.req._reconnect = this._reconnect; }; this.res = res; for (var mw of middleware) if (await mw.call(this)) return; delete this.req; delete this.res; this._proxy.web(req, res, this._proxyOptions); }); this._server = http.createServer(app); }; util.inherits(HttpProxy, BaseProxy); /** * Update proxy options. * * @method * @arg {string} targetUrl - URL which should be proxied. */ HttpProxy.prototype.updateOptions = function (targetUrl) { targetUrl = targetUrl || this._initUrl; var parsedUrl = url.parse(targetUrl); if (this._port) { this._url = _.trimEnd(`http://${U.hostname}:${this._port}` + url.parse(targetUrl).pathname, &quot;/&quot;); }; expect([&quot;http:&quot;, &quot;https:&quot;], &quot;Unsupported protocol&quot;).include(parsedUrl.protocol); // FIXME work around bug in `node-http-proxy` this._proxy.options = { proxyTimeout: this._timeout }; if (parsedUrl.protocol === &quot;https:&quot;) { this._proxyOptions = { target: &quot;https://&quot; + parsedUrl.host, agent: https.globalAgent, headers: { host: parsedUrl.hostname }, }; } else { this._proxyOptions = { target: { host: parsedUrl.hostname, port: parsedUrl.port, }, }; }; }; /** * Starts proxy server if it’s not started yet. * * @method */ HttpProxy.prototype.start = function () { return new Promise((resolve, reject) =&gt; { this._server.listen(this._port, err =&gt; { if (err) return reject(err); this._port = this._server.address().port; this._url = _.trimEnd(`http://${U.hostname}:${this._port}` + url.parse(this._initUrl).pathname, &quot;/&quot;); this.isRunning = true; resolve(this._url); }); }) .then(() =&gt; cache.init()) .then(() =&gt; this._url); }; /** * Stops proxy server if it’s not stopped yet. * * @method */ HttpProxy.prototype.stop = function () { if (!this.isRunning) return; this._server.close(); this._proxy.close(); this.proxyUrl = null; this.isRunning = false; }; × Search results Close "},"index.js.html":{"id":"index.js.html","title":"Source: index.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: index.js &quot;use strict&quot;; /** * `GlaceJS` proxy. * * @module */ module.exports = { Commands: require(&quot;./commands&quot;), GlobalProxy: require(&quot;./globalProxy&quot;), HttpProxy: require(&quot;./httpProxy&quot;), Steps: require(&quot;./steps&quot;), }; × Search results Close "},"interactive.js.html":{"id":"interactive.js.html","title":"Source: interactive.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: interactive.js &quot;use strict&quot;; /** * Interactive console interface. * * @module */ var _ = require(&quot;lodash&quot;); var vorpal = require(&quot;vorpal&quot;)(); require(&quot;colors&quot;); // should be imported after vorpal var U = require(&quot;glacejs-utils&quot;); var d = U.switchColor(); /** * Interactive console. * * @function * @arg {Commands} cmd - Commands instance. */ var interactive = module.exports = cmd =&gt; { vorpal .command(&quot;chrome&quot;) .description(d(&quot;Launch google chrome browser.&quot;, &quot;Pristine profile will be used each time.&quot;)) .action(function (args, cb) { return cmd .launchChrome() .then(isOk =&gt; { if (!isOk) return; this.log(&quot;Chrome browser is launched&quot;.green); }) .catch(e =&gt; this.log(e)) .then(cb); }); vorpal .command(&quot;chrome close&quot;) .description(d(&quot;Close google chrome browser.&quot;)) .action(function (args, cb) { return cmd .closeChrome() .then(isOk =&gt; { if (!isOk) return; this.log(&quot;Chrome browser is closed&quot;.green); }) .catch(e =&gt; this.log(e)) .then(cb); }); vorpal .command(&quot;chrome restart&quot;) .description(d(&quot;Restart google chrome browser.&quot;, &quot;Pristine profile will be used each time.&quot;)) .action(function (args, cb) { return cmd .restartChrome() .then(isOk =&gt; { if (!isOk) return; this.log(&quot;Chrome browser is launched&quot;.green); }) .catch(e =&gt; this.log(e)) .then(cb); }); vorpal .command(&quot;proxy speed &lt;speed&gt;&quot;) .description(d(&quot;Limit proxy speed, kb/s.&quot;)) .action(function (args, cb) { if (!parseInt(args.speed)) { this.log(&quot;Speed value should be a number&quot;.red); return cb(); }; return cmd .setProxySpeed(args.speed) .then(() =&gt; this.log(`Proxy speed is limited to ${args.speed} kb/s`.green)) .catch(e =&gt; this.log(e)) .then(cb); }); vorpal .command(&quot;proxy speed reset&quot;) .description(d(&quot;Unlimit proxy speed.&quot;)) .action(function (args, cb) { return cmd .resetProxySpeed() .then(() =&gt; this.log(&quot;Proxy speed is unlimited&quot;.green)) .catch(e =&gt; this.log(e)) .then(cb); }); vorpal .command(&quot;cache&quot;) .description(d(&quot;Cache server responses to disk.\\nCached responses&quot;, &quot;will be replayed by proxy.&quot;)) .action(function (args, cb) { return cmd .enableProxyCache() .then(() =&gt; this.log(&quot;Proxy cache is enabled&quot;.green)) .catch(e =&gt; this.log(e)) .then(cb); }); vorpal .command(&quot;cache disable&quot;) .description(d(&quot;Disable proxy cache.&quot;)) .action(function (args, cb) { return cmd .disableProxyCache() .then(() =&gt; this.log(&quot;Proxy cache is disabled&quot;.green)) .catch(e =&gt; this.log(e)) .then(cb); }); vorpal .command(&quot;cache clear&quot;) .description(d(&quot;Remove cached responses from storage.&quot;)) .action(function (args, cb) { return this.prompt({ type: &quot;confirm&quot;, name: &quot;continue&quot;, default: false, message: &quot;Proxy cache will be cleaned. It won't be undo. Continue?&quot;.yellow, }, result =&gt; { if (!result.continue) { this.log(&quot;Cancelled by user&quot;.green); return cb(); }; return cmd.clearProxyCache() .then(() =&gt; this.log(&quot;Proxy cache is cleaned&quot;.green)) .catch(e =&gt; this.log(e)) .then(cb); }); }); vorpal.delimiter(&quot;&gt;&quot;.red.bold).show(); var finalize = () =&gt; { if (cmd._isChromeLaunched()) cmd.closeChrome(); }; vorpal.on(&quot;client_prompt_submit&quot;, name =&gt; { if (name === &quot;exit&quot;) finalize(); }); }; × Search results Close "},"logger.js.html":{"id":"logger.js.html","title":"Source: logger.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: logger.js &quot;use strict&quot;; /** * Configures logging. * * @module */ var fs = require(&quot;fs&quot;); var winston = require(&quot;winston&quot;); var CONF = require(&quot;./config&quot;); if (fs.existsSync(CONF.log.path)) fs.unlinkSync(CONF.log.path); var logger = new winston.Logger; logger.level = CONF.log.level; logger.add(winston.transports.File, { filename: CONF.log.path, json: false }); if (CONF.log.stdout) logger.add(winston.transports.Console); module.exports = logger; × Search results Close "},"middleware_cache.js.html":{"id":"middleware_cache.js.html","title":"Source: middleware/cache.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: middleware/cache.js &quot;use strict&quot;; /** * Middleware to cache responses. * * @module */ var fs = require(&quot;fs&quot;); var path = require(&quot;path&quot;); var _ = require(&quot;lodash&quot;); var cacheManager = require(&quot;cache-manager&quot;); var fse = require(&quot;fs-extra&quot;); var fsStore = require(&quot;cache-manager-fs&quot;); var rimraf = require(&quot;rimraf&quot;); var CONF = require(&quot;../config&quot;); var LOG = require(&quot;../logger&quot;); if (!CONF.cache.existing &amp;&amp; fs.existsSync(CONF.cache.folder)) { fse.removeSync(CONF.cache.folder); }; var diskCache, inited; var init = opts =&gt; { opts = opts || {}; opts.force = opts.force || false; if (!inited || opts.force) { inited = new Promise(resolve =&gt; { var fillcb = null; if (CONF.cache.existing) fillcb = resolve; diskCache = cacheManager.caching({ store: fsStore, options: { ttl: CONF.cache.ttl, maxsize: CONF.cache.size, path: CONF.cache.folder, preventfill: !CONF.cache.existing, fillcallback: fillcb } }); if (!CONF.cache.existing) resolve(); }); }; return inited; }; init(); /** * Middleware to cache server responses and reply them. * * @function * @this BaseProxy * @return {boolean} - `true` if response was retrieved from cache, `false` * otherwise. */ var cache = module.exports = async function () { if (!this.useCache) return false; if (!diskCache) return false; for (var skipped of cache.skipped.req) { if (skipped(this.req)) return false; }; var req = this.req; var res = this.res; if (await fromCache(req, res)) { return true; } else { toCache(req, res); return false; }; }; /** * @prop {object} skipped - Filters to skip caching. * @prop {function[]} [skipped.req=[]] - List of filters to skip by request. * @prop {function[]} [skipped.res=[]] - List of filters to skip by response. */ cache.skipped = { req: [], res: [] }; /** * Initializes cache. Does nothing if it is initialized already and no force option. * * @function * @arg {object} [opts] - Initialization options. * @arg {boolean} [opts.force=false] - Force reinitialize cache. * @return {Promise} */ cache.init = init; /** * Patches http response to send response from cache, if it is there. * * @function * @arg {object} req - http(s) request * @arg {object} res - http(s) response * @return {Promise.&lt;boolean&gt;} - `true` if response is in cache and * was patched, otherwise `false` */ var fromCache = (req, res) =&gt; { return new Promise((resolve, reject) =&gt; { diskCache.get(_getReqKey(req), (err, result) =&gt; { if (err) reject(err); resolve(result); }); }).then(cached =&gt; { if (!cached) return false; LOG.debug(&quot;&lt;&lt;&lt; from cache:&quot;, _getReqKey(req)); var response = JSON.parse(cached); res.writeHead(response.code, response.headers); res.end(Buffer.from(response.data)); return true; }); }; /** * Patches http response to put response to cache. * * @function * @arg {object} req - http(s) request * @arg {object} res - http(s) response */ var toCache = (req, res) =&gt; { var resWrite = res.write; var resEnd = res.end; var chunks = []; res.write = function (chunk) { if (chunk instanceof Buffer) chunks.push(chunk); resWrite.apply(this, arguments); }; res.end = function (chunk) { if (chunk instanceof Buffer) chunks.push(chunk); var data = Buffer.concat(chunks).toJSON(); if (res.statusCode !== 200 || !data.data.lenght) { return resEnd.apply(this, arguments); }; for (var skipped of cache.skipped.res) { if (skipped(res)) { return resEnd.apply(this, arguments); }; }; var resData = JSON.stringify({ data: data, code: res.statusCode, headers: res.headers }); LOG.debug(&quot;&gt;&gt;&gt; to cache:&quot;, _getReqKey(req)); diskCache.set(_getReqKey(req), resData); resEnd.apply(this, arguments); }; }; × Search results Close "},"middleware_index.js.html":{"id":"middleware_index.js.html","title":"Source: middleware/index.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: middleware/index.js &quot;use strict&quot;; /** * Proxy middlewares. * * @module */ module.exports = [ require(&quot;./reqBody&quot;), require(&quot;./resHeaders&quot;), require(&quot;./speed&quot;), require(&quot;./info&quot;), require(&quot;./cache&quot;), ]; × Search results Close "},"middleware_info.js.html":{"id":"middleware_info.js.html","title":"Source: middleware/info.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: middleware/info.js &quot;use strict&quot;; /** * Contains proxy middlewares * * @module */ var _ = require(&quot;lodash&quot;); var info = module.exports = function () { if (!this.responsesData) return false; var res = this.res; var req = this.req; var data = { name: req.headers.host + req.url, reqHeaders: req.headers, resHeaders: {}, statusCode: null, statusMessage: null, size: 0, chunkSizes: [] }; this.responsesData.push(data); var resWrite = res.write; var resEnd = res.end; var addData = chunk =&gt; { if (!chunk) return; data.chunkSizes.push(chunk.length); data.size += chunk.length; }; res.write = function (chunk) { addData(chunk); resWrite.apply(this, arguments); }; res.end = function (chunk) { addData(chunk); data.resHeaders = _.cloneDeep(res.headers); data.statusCode = res.statusCode; data.statusMessage = data.statusMessage; resEnd.apply(this, arguments); }; return false; }; × Search results Close "},"middleware_reqBody.js.html":{"id":"middleware_reqBody.js.html","title":"Source: middleware/reqBody.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: middleware/reqBody.js &quot;use strict&quot;; /** * Middleware to store request body. * * @module */ var reqBody = module.exports = function () { var chunks = []; var req = this.req; if (req.body) return; var emit = req.emit; req.emit = function (ev, chunk) { if (ev === &quot;data&quot;) { if (chunk instanceof Buffer) chunks.push(chunk); } else if (ev === &quot;end&quot;) { if (chunk instanceof Buffer) chunks.push(chunk); req.body = Buffer.concat(chunks); }; emit.apply(this, arguments); }; }; × Search results Close "},"middleware_resHeaders.js.html":{"id":"middleware_resHeaders.js.html","title":"Source: middleware/resHeaders.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: middleware/resHeaders.js &quot;use strict&quot;; /** * Middleware to cache responses. * * @module */ var _ = require(&quot;lodash&quot;); var resHeaders = module.exports = function () { var res = this.res; var req = this.req; var resHead = res.writeHead; var resHeader = res.setHeader; res.headers = res.headers || {}; res.writeHead = function (statusCode, statusMsg, headers) { if (_.isPlainObject(statusMsg) &amp;&amp; !headers) { headers = statusMsg; statusMsg = undefined; }; if (statusCode) { res.statusCode = res.statusCode || statusCode; }; if (statusMsg) { res.statusMessage = res.statusMessage || statusMsg; }; if (_.isPlainObject(headers)) { _.assign(res.headers, headers); }; return resHead.apply(this, arguments); }; res.setHeader = function(name, value) { res.headers[name] = value; return resHeader.apply(this, arguments); }; }; × Search results Close "},"middleware_speed.js.html":{"id":"middleware_speed.js.html","title":"Source: middleware/speed.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: middleware/speed.js &quot;use strict&quot;; /** * Middleware to manage responses speed. * * @module */ var changeResponsesSpeed = module.exports = function () { if (!this.speed) return; var res = this.res; var req = this.req; var timer = 1; var size = Math.ceil(this.speed / 8); var prms = Promise.resolve(); var resWrite = res.write; var resEnd = res.end; var promisify = args =&gt; { var chunk = args[0]; if (!chunk) return; for (var i = 0; i &lt; chunk.length; i += size) { prms = prms.then((idx =&gt; () =&gt; { return new Promise((resolve, reject) =&gt; { setTimeout(() =&gt; { args[0] = chunk.slice(idx, idx + size); resWrite.apply(res, args); resolve(); }, timer); }); })(i)); }; }; res.write = function () { promisify(Array.from(arguments)); }; res.end = function () { var args = Array.from(arguments); promisify(args); prms.then(() =&gt; { args[0] = null; resEnd.apply(res, args); }); }; return false; }; × Search results Close "},"steps.js.html":{"id":"steps.js.html","title":"Source: steps.js","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Source: steps.js &quot;use strict&quot;; /** * `GlaceJS` steps for proxy. * * @module */ var _ = require(&quot;lodash&quot;); var expect = require(&quot;chai&quot;).expect; var U = require(&quot;glacejs-utils&quot;); var LOG = require(&quot;./logger&quot;); var GlobalProxy = require(&quot;./globalProxy&quot;); var HttpProxy = require(&quot;./httpProxy&quot;); /** * Steps to manage proxy. * * @mixin */ module.exports = { /** * Step to start proxy. Step recall will be skipped if proxy wasn't * stopped before. * * @async * @method * @instance * @arg {object} [opts] - Step options. * @arg {string} [opts.appUrl] - Web application url which will * be proxied. Default value will be requested from `config.appUrl` * if it is specified. * @arg {boolean} [opts.useCache] - Flag to use proxy cache for * responses. Default value will be requested from `config.useCache` * if it is specified. * @arg {number} [opts.timeout] - Proxy timeout to break connection. * Default value will be requested from `config.timeout.proxy`. * @arg {number} [opts.reconnect] - Number of proxy reconnects on failure. * @arg {number} [opts.port] - Proxy port. Default value will be * requested from `config.proxyPort`. * @arg {boolean} [opts.check=true] - Flag to check that proxy was launched. * @return {Promise&lt;string&gt;} - Proxied URL. * @throws {AssertionError} - If proxy was not launched. */ startProxy: async function (opts) { if (this._isProxyStarted) { LOG.warn(&quot;Step to start proxy was passed already&quot;); return; }; opts = U.defVal(opts, {}); var appUrl = U.defVal(opts.appUrl, this._config.appUrl); var useCache = U.defVal(opts.useCache, this._config.cache.use); var timeout = U.defVal(opts.timeout, this._config.proxy.timeout); var reconnect = U.defVal(opts.reconnect, this._config.proxy.reconnect); var port = U.defVal(opts.port, this._config.proxy.port); var check = U.defVal(opts.check, true); this._proxy = new HttpProxy({ url: appUrl, useCache: useCache, timeout: timeout, reconnect: reconnect, port: port }); await this._proxy.start(); if (check) { expect(this._proxy.isRunning, &quot;Proxy was not launched&quot;).be.true; }; this._isProxyStarted = true; this._appUrl = this._proxy.proxyUrl; return this._proxy.proxyUrl; }, /** * Step to get proxy URL. * * @method * @instance * @arg {object} [opts] - Step options. * @arg {boolean} [opts.check=true] - Flag to check that proxy URL is * defined. * @throws {AssertionError} - If proxy URL isn't defined. */ getProxyUrl: function (opts) { opts = U.defVal(opts, {}); var check = U.defVal(opts.check, true); if (check) { expect(this._proxy.proxyUrl, &quot;Proxy was not launched&quot;).to.exist; }; return this._proxy.proxyUrl; }, /** * Step to stop proxy. Step call will be skipped if proxy wasn't launched * before. * * @method * @instance * @async * @arg {object} [opts] - Step options. * @arg {boolean} [opts.check=true] - Flag to check that proxy was * stopped. * @throws {AssertionError} - If proxy wasn't stopped. */ stopProxy: async function (opts) { if (!this._isProxyStarted) { LOG.warn(&quot;Step to start proxy wasn't passed yet&quot;); return; }; opts = U.defVal(opts, {}); var check = U.defVal(opts.check, true); await this._proxy.stop(); if (check) { expect(this._proxy.isRunning, &quot;Proxy wasn't stopped&quot;).be.false; }; this._appUrl = this._config.appUrl; this._isProxyStarted = false; }, /** * Step to start global proxy. Step recall will be skipped if global * proxy wasn't stopped before. * * @method * @instance * @async * @arg {object} [opts] - Step options. * @arg {boolean} [opts.useCache] - Flag to use proxy cache for * responses. Default value will be requested from `config.useCache` * if it is specified. * @arg {number} [opts.timeout] - Proxy timeout to break connection. * Default value will be requested from `config.timeout.proxy`. * @arg {number} [opts.reconnect] - Number of proxy reconnects on failure. * @arg {number} [opts.port] - Proxy port. Default value will be * requested from `config.globalProxyPort`. * @arg {boolean} [opts.check=true] - Flag to check that proxy was launched. * @throws {AssertionError} - If global proxy was not launched. */ startGlobalProxy: async function (opts) { if (this._isGlobalProxyStarted) { LOG.warn(&quot;Step to start global proxy was passed already&quot;); return; }; opts = U.defVal(opts, {}); var useCache = U.defVal(opts.useCache, this._config.cache.use); var timeout = U.defVal(opts.timeout, this._config.timeouts.proxy); var reconnect = U.defVal(opts.reconnect, this._config.proxy.reconnect); var port = U.defVal(opts.port, this._config.globalProxyPort); var check = U.defVal(opts.check, true); this._globalProxy = new GlobalProxy({ useCache: useCache, timeout: timeout, reconnect: reconnect, port: port, installCertificate: this._config.installCertificate }); await this._globalProxy.start(); if (check) { expect(this._globalProxy.isRunning, &quot;Global proxy was not launched&quot;) .to.be.true; }; this._isGlobalProxyStarted = true; }, /** * Step to stop global proxy. Step call will be skipped if global proxy * wasn't launched before. * * @method * @instance * @async * @arg {object} [opts] - Step options. * @arg {boolean} [opts.check=true] - Flag to check that global * proxy was stopped. * @throws {AssertionError} - If global proxy wasn't stopped. */ stopGlobalProxy: async function (opts) { if (!this._isGlobalProxyStarted) { LOG.warn(&quot;Step to start global proxy wasn't passed yet&quot;); return; }; opts = U.defVal(opts, {}); var check = U.defVal(opts.check, true); await this._globalProxy.stop(); if (check) { expect(this._globalProxy.isRunning, &quot;Global proxy wasn't stopped&quot;).be.false; }; this._isGlobalProxyStarted = false; }, /** * Step to limit proxy speed. * * @method * @instance * @arg {number} speed - Proxy limited speed, kb/s. * @arg {object} [opts] - Step options. * @arg {boolean} [opts.check=true] - Flat to check that proxy speed * is limited. * @throws {AssertionError} - If proxy speed is not limited. */ limitProxySpeed: function (speed, opts) { this._checkProxy(); opts = U.defVal(opts, {}); var check = U.defVal(opts.check, true); if (this._proxy) { this._proxy.setSpeed(speed); }; if (this._globalProxy) { this._globalProxy.setSpeed(speed); }; if (check) { if (this._proxy) { expect(this._proxy.speed, &quot;Proxy speed is not limited&quot;).be.equal(speed); }; if (this._globalProxy) { expect(this._globalProxy.speed, &quot;Global proxy speed is not limited&quot;).be.equal(speed); }; }; }, /** * Step to unlimit proxy speed. * * @method * @instance * @arg {object} [opts] - Step options. * @arg {boolean} [opts.check=true] - Flag to check that proxy speed * is unlimited. * @throws {AssertionError} - If proxy speed is still limited. */ unlimitProxySpeed: function (opts) { this._checkProxy(); opts = U.defVal(opts, {}); var check = U.defVal(opts.check, true); if (this._proxy) { this._proxy.resetSpeed(); }; if (this._globalProxy) { this._globalProxy.resetSpeed(); }; if (check) { if (this._proxy) { expect(this._proxy.speed, &quot;Proxy speed still has limited value&quot;).be.null; }; if (this._globalProxy) { expect(this._globalProxy.speed, &quot;Global proxy speed still has limited value&quot;).be.null; }; }; }, /** * Step to start responses measurement. * * @method * @instance * @arg {object} [opts] - Step options. * @arg {boolean} [opts.check=true] - Flag to check that responses * measurement is launched. * @throws {AssertionError} - If responses measurement is not launched. */ measureResponses: function (opts) { this._checkProxy(); opts = U.defVal(opts, {}); var check = U.defVal(opts.check, true); if (this._proxy) { this._proxy.measureResponses(); }; if (this._globalProxy) { this._globalProxy.measureResponses(); }; if (check) { if (this._proxy) { expect(this._proxy.getResponsesData(), &quot;Proxy responses measurement is not launched&quot;) .to.exist; }; if (this._globalProxy) { expect(this._globalProxy.getResponsesData(), &quot;Global proxy responses measurement is not launched&quot;) .to.exist; }; }; }, /** * Step to get measured responses data. * * @method * @instance * @arg {object} [opts] - Step options. * @arg {boolean} [opts.check=true] - Flag to check that responses * data are present. * @throws {AssertionError} - If responses data are absent. */ getResponsesData: function (opts) { this._checkProxy(); opts = U.defVal(opts, {}); var check = U.defVal(opts.check, true); var data = []; if (this._proxy &amp;&amp; this._proxy.getResponsesData()) { data = data.concat(this._proxy.getResponsesData()); }; if (this._globalProxy &amp;&amp; this._globalProxy.getResponsesData()) { data = data.concat(this._globalProxy.getResponsesData()); }; if (check) { expect(_.isEmpty(data), &quot;Responses data are absent&quot;).be.false; }; return data; }, /** * Step to stop responses measurement. * * @method * @instance * @arg {object} [opts] - Step options. * @arg {boolean} [opts.check=true] - Flag to check that responses * measurement is stopped. * @throws {AssertionError} - If responses measurement is still running. */ unmeasureResponses: function (opts) { this._checkProxy(); opts = U.defVal(opts, {}); var check = U.defVal(opts.check, true); if (this._proxy) { this._proxy.unmeasureResponses(); }; if (this._globalProxy) { this._globalProxy.unmeasureResponses(); }; if (check) { if (this._proxy) { expect(this._proxy.getResponsesData(), &quot;Proxy responses measurement is still running&quot;) .to.be.null; }; if (this._globalProxy) { expect(this._globalProxy.getResponsesData(), &quot;Global proxy responses measurement is still running&quot;) .to.be.null; }; }; }, /** * Step to enable cache. * * @method * @instance */ enableCache: function () { this._checkProxy(); if (this._proxy) this._proxy.useCache = true; if (this._globalProxy) this._globalProxy.useCache = true; }, /** * Step to disable cache. * * @method * @instance */ disableCache: function () { this._checkProxy(); if (this._proxy) this._proxy.useCache = false; if (this._globalProxy) this._globalProxy.useCache = false; }, /** * Helper to check that proxy is launched. * * @method * @protected * @instance * @throws {AssertionError} - If no proxy is launched. */ _checkProxy: function () { expect(this._proxy || this._globalProxy, &quot;No proxy is launched&quot;).to.exist; }, }; × Search results Close "},"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Modules Classes BaseProxy Commands GlobalProxy HttpProxy Mixins module:steps Namespaces config × Search results Close "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Classes Classes BaseProxy Commands GlobalProxy HttpProxy Mixins module:steps Namespaces config × Search results Close "},"namespaces.list.html":{"id":"namespaces.list.html","title":"Namespaces","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Namespaces Classes BaseProxy Commands GlobalProxy HttpProxy Mixins module:steps Namespaces config × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy GlaceJS ProxyAnnotation × Search results Close "},"module-baseProxy.html":{"id":"module-baseProxy.html","title":"Module: baseProxy","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: baseProxy Base proxy. Source: baseProxy.js, line 2 Classes BaseProxy × Search results Close "},"module-baseProxy-BaseProxy.html":{"id":"module-baseProxy-BaseProxy.html","title":"Class: BaseProxy","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Class: BaseProxy baseProxy~ BaseProxy &lt;abstract&gt; new BaseProxy( [opts]) Base proxy. Parameters: Name Type Argument Description opts object &lt;optional&gt; Options. Properties Name Type Argument Default Description speed number &lt;optional&gt; &lt;nullable&gt; null Proxy speed, kb/s. useCache boolean &lt;optional&gt; false Flag to use cache middleware. reconnect number &lt;optional&gt; 0 Number of times reconnect to remote side, if it breaks connection. timeout timeout &lt;optional&gt; 60000 Time to wait remote side response, ms. port port &lt;optional&gt; 0 Port. Default is random. Source: baseProxy.js, line 23 Methods getResponsesData() Gets responses data. Source: baseProxy.js, line 73 measureResponses() Starts to measure responses and gather information of them. Source: baseProxy.js, line 57 resetSpeed() Resets speed of responses. Source: baseProxy.js, line 49 setSpeed(speed) Sets speed of responses from proxy to client. Parameters: Name Type Description speed number Proxy responses speed. kb/s. Source: baseProxy.js, line 41 start() Starts proxy. Source: baseProxy.js, line 82 stop() Stops proxy server. Source: baseProxy.js, line 90 unmeasureResponses() Disables responses measurement. Source: baseProxy.js, line 65 × Search results Close "},"module-cli.html":{"id":"module-cli.html","title":"Module: cli","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: cli GlaceJS proxy runner. Source: cli.js, line 2 Methods &lt;static&gt; run() Proxy runner. Source: cli.js, line 22 × Search results Close "},"module-commands.html":{"id":"module-commands.html","title":"Module: commands","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: commands Commands to manage GlaceJS proxy. Source: commands.js, line 2 Classes Commands × Search results Close "},"module-commands-Commands.html":{"id":"module-commands-Commands.html","title":"Class: Commands","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Class: Commands commands~ Commands new Commands(config [, opts]) Creates commands instance. Parameters: Name Type Argument Description config object Commands config. opts object &lt;optional&gt; Commands options. Properties Name Type Argument Default Description logger function &lt;optional&gt; Commands logger. Default is system logger. colored boolean &lt;optional&gt; false Flag to use ANSI color in log message. Source: commands.js, line 35 Methods &lt;protected&gt; _checkProxy() Helper to check whether proxy is launched. Source: commands.js, line 392 Returns: true if proxy exists and is launched, false otherwise. Type boolean &lt;protected&gt; _isChromeLaunched() Helper to define whether chrome is launched. Source: commands.js, line 405 &lt;async&gt; clearProxyCache() Command to clear proxy cache. Source: commands.js, line 379 Returns: Type Promise &lt;async&gt; closeChrome() Command to close chrome browser. Source: commands.js, line 278 Returns: true if chrome browser was closed. false if command can't be executed. Causes to not close chrome browser: Chrome browser isn't launched yet. Type Promise.&lt;boolean&gt; &lt;async&gt; disableProxyCache() Command to disable proxy cache. Source: commands.js, line 364 Returns: true if proxy cache wasn't disabled. false if command can't be executed. Causes to not disable proxy cache: HTTP proxy isn't launched. Type Promise.&lt;boolean&gt; &lt;async&gt; enableProxyCache() Command to enable proxy cache. Source: commands.js, line 347 Returns: true if proxy cache wasn't enabled. false if command can't be executed. Causes to not enable proxy cache: HTTP proxy isn't launched. Type Promise.&lt;boolean&gt; &lt;async&gt; launchChrome() Command to launch chrome browser. Source: commands.js, line 212 Returns: true if chrome browser was launched. false if command can't be executed. Causes to not launch chrome browser: HTTP proxy isn't launched yet. Chrome browser is launched already. Type Promise.&lt;boolean&gt; &lt;async&gt; launchGlobalProxy() Command to launch global transparent proxy. Source: commands.js, line 132 Returns: true if global transparent proxy isn't launched. false if command can't be executed. Causes to not launch global transparent proxy: Global transparent proxy is launched already. Type Promise.&lt;boolean&gt; &lt;async&gt; launchHttpProxy() Command to launch HTTP proxy. Source: commands.js, line 56 Returns: true if HTTP proxy was launched. false if command can't be executed. Causes to not launch HTTP proxy: HTTP proxy is launched already. Proxied URL isn't specified. Type Promise.&lt;boolean&gt; &lt;async&gt; resetProxySpeed() Command to reset proxy speed. Source: commands.js, line 330 Returns: true if proxy speed was reset. false if command can't be executed. Causes to not reset proxy speed: HTTP proxy isn't launched. Type Promise.&lt;boolean&gt; &lt;async&gt; restartChrome() Command to restart chrome browser. Source: commands.js, line 300 Returns: true if chrome browser was restarted. false if command can't be executed. Causes to not restart chrome browser are the the same as for command to launch chrome browser. Type Promise.&lt;boolean&gt; &lt;async&gt; restartGlobalProxy() Command to restart global transparent proxy. Source: commands.js, line 199 Returns: true if global transparent proxy was restarted. false if command can't be executed. Causes to not restart global transparent proxy are the same as for command to launch global transparent proxy. Type Promise.&lt;boolean&gt; &lt;async&gt; restartHttpProxy() Command to restart HTTP proxy. Source: commands.js, line 119 Returns: true if HTTP proxy was restarted. false if command can't be executed. Causes to not restart HTTP proxy are the same as for command to launch HTTP proxy. Type Promise.&lt;boolean&gt; &lt;async&gt; setProxySpeed(speed) Command to set proxy speed. Parameters: Name Type Description speed number Proxy speed, kb/s. Source: commands.js, line 313 Returns: true if proxy speed was set. false if command can't be executed. Causes to not set proxy speed: HTTP proxy isn't launched. Type Promise.&lt;boolean&gt; &lt;async&gt; stopGlobalProxy() Command to stop global transparent proxy. Source: commands.js, line 176 Returns: true if global transparent proxy was stopped. false if command can't be executed. Causes to not stop global transparent proxy: Global transparent proxy isn't launched yet. Type Promise.&lt;boolean&gt; &lt;async&gt; stopHttpProxy() Command to stop HTTP proxy. Source: commands.js, line 104 Returns: true if HTTP proxy was stopped. false if command can't be executed. Causes to not stop HTTP proxy: HTTP proxy isn't launched yet. Type Promise.&lt;boolean&gt; × Search results Close "},"module-config.html":{"id":"module-config.html","title":"Module: config","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: config Configures GlaceJS proxy before run. Source: config.js, line 2 Namespaces config × Search results Close "},"module-config-config.html":{"id":"module-config-config.html","title":"Namespace: config","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Namespace: config config~ config Contains GlaceJS proxy configuration. Properties: Name Type Argument Default Description url string &lt;optional&gt; &lt;nullable&gt; null Proxied URL. cache object Cache config. Properties Name Type Argument Default Description ttl number &lt;optional&gt; Time to life cache. Default is maximum. size number &lt;optional&gt; Maximum cached file size. Default is 10 GB. use boolean &lt;optional&gt; false Use cache. existing boolean &lt;optional&gt; false Use existing cache if exists. folder boolean &lt;optional&gt; cwd/.proxy-cache Cache folder. chrome object Chrome config. Properties Name Type Argument Default Description launch boolean &lt;optional&gt; false Launch chrome browser. incognito boolean &lt;optional&gt; false Use incognito mode in chrome. log object Log config. Properties Name Type Argument Default Description level string &lt;optional&gt; debug Log level. path string &lt;optional&gt; cwd/glace-proxy.log Log file path. stdout boolean &lt;optional&gt; false Print log messages to terminal. proxy object Proxy config. Properties Name Type Argument Default Description timeout number &lt;optional&gt; 60000 Proxy time to wait for remote response, ms. http number &lt;optional&gt; false Launch http proxy. port number &lt;optional&gt; 0 Proxy port. By default will be assigned by OS. global boolean &lt;optional&gt; false Launch global proxy. globalPort number &lt;optional&gt; 8888 Global proxy port. installCertificates boolean &lt;optional&gt; Install global proxy certificates as trusted. Windows only. Admin privileges are required. reconnect number &lt;optional&gt; 2 Number of reconnect attemptions if remote side breaks connection. Source: config.js, line 63 × Search results Close "},"module-globalProxy.html":{"id":"module-globalProxy.html","title":"Module: globalProxy","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: globalProxy Describes global transparent proxy. Source: globalProxy.js, line 2 Classes GlobalProxy Members &lt;inner&gt; _onError Patch mitm proxy error processing, in order to avoid default response finalizing on reconnect. Source: globalProxy.js, line 25 × Search results Close "},"module-globalProxy-GlobalProxy.html":{"id":"module-globalProxy-GlobalProxy.html","title":"Class: GlobalProxy","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Class: GlobalProxy globalProxy~ GlobalProxy Contains methods to run and manage global transparent proxy. new GlobalProxy( [opts]) Creates new instance of GlobalProxy. Parameters: Name Type Argument Description opts object &lt;optional&gt; global proxy options Properties Name Type Argument Default Description port number &lt;optional&gt; 8080 global proxy port timeout number &lt;optional&gt; 0 global proxy timeout installCertificate boolean &lt;optional&gt; false flag to install global proxy certificate as trusted in order to manage https connection or no rootPath string &lt;optional&gt; &lt;nullable&gt; Folder where proxy starts in order to generate self-signed certificate. By default is current work directory. useCache boolean &lt;optional&gt; false flag to cache and take from cache responses Source: globalProxy.js, line 50 Methods start() Starts global proxy if it&quot;s not started yet. Source: globalProxy.js, line 112 stop() Stops global proxy if it's not stopped yet. Source: globalProxy.js, line 157 × Search results Close "},"module-help.html":{"id":"module-help.html","title":"Module: help","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: help Help description. Source: help.js, line 2 × Search results Close "},"module-httpProxy.html":{"id":"module-httpProxy.html","title":"Module: httpProxy","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: httpProxy Http Proxy classes and functions. Source: httpProxy.js, line 2 Classes HttpProxy × Search results Close "},"module-httpProxy-HttpProxy.html":{"id":"module-httpProxy-HttpProxy.html","title":"Class: HttpProxy","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Class: HttpProxy httpProxy~ HttpProxy new HttpProxy(opts) Http Proxy. Parameters: Name Type Description opts object Proxy options. Properties Name Type Description url string URL which should be proxied. them from cache. Source: httpProxy.js, line 35 Methods start() Starts proxy server if it’s not started yet. Source: httpProxy.js, line 125 stop() Stops proxy server if it’s not stopped yet. Source: httpProxy.js, line 146 updateOptions(targetUrl) Update proxy options. Parameters: Name Type Description targetUrl string URL which should be proxied. Source: httpProxy.js, line 87 × Search results Close "},"module-index.html":{"id":"module-index.html","title":"Module: index","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: index GlaceJS proxy. Source: index.js, line 2 × Search results Close "},"module-interactive.html":{"id":"module-interactive.html","title":"Module: interactive","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: interactive Interactive console interface. Source: interactive.js, line 2 Methods &lt;inner&gt; interactive(cmd) Interactive console. Parameters: Name Type Description cmd Commands Commands instance. Source: interactive.js, line 20 × Search results Close "},"module-logger.html":{"id":"module-logger.html","title":"Module: logger","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: logger Configures logging. Source: logger.js, line 2 × Search results Close "},"module-middleware_cache.html":{"id":"module-middleware_cache.html","title":"Module: middleware/cache","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: middleware/cache Middleware to cache responses. Source: middleware/cache.js, line 2 Methods &lt;inner&gt; cache() Middleware to cache server responses and reply them. This: BaseProxy Source: middleware/cache.js, line 60 Returns: true if response was retrieved from cache, false otherwise. Type boolean &lt;inner&gt; fromCache(req, res) Patches http response to send response from cache, if it is there. Parameters: Name Type Description req object http(s) request res object http(s) response Source: middleware/cache.js, line 102 Returns: true if response is in cache and was patched, otherwise false Type Promise.&lt;boolean&gt; &lt;inner&gt; toCache(req, res) Patches http response to put response to cache. Parameters: Name Type Description req object http(s) request res object http(s) response Source: middleware/cache.js, line 127 × Search results Close "},"module-middleware_index.html":{"id":"module-middleware_index.html","title":"Module: middleware/index","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: middleware/index Proxy middlewares. Source: middleware/index.js, line 2 × Search results Close "},"module-middleware_info.html":{"id":"module-middleware_info.html","title":"Module: middleware/info","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: middleware/info Contains proxy middlewares Source: middleware/info.js, line 2 × Search results Close "},"module-middleware_reqBody.html":{"id":"module-middleware_reqBody.html","title":"Module: middleware/reqBody","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: middleware/reqBody Middleware to store request body. Source: middleware/reqBody.js, line 2 × Search results Close "},"module-middleware_resHeaders.html":{"id":"module-middleware_resHeaders.html","title":"Module: middleware/resHeaders","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: middleware/resHeaders Middleware to cache responses. Source: middleware/resHeaders.js, line 2 × Search results Close "},"module-middleware_speed.html":{"id":"module-middleware_speed.html","title":"Module: middleware/speed","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Module: middleware/speed Middleware to manage responses speed. Source: middleware/speed.js, line 2 × Search results Close "},"module-steps.html":{"id":"module-steps.html","title":"Mixin: module:steps","body":" GlaseJS Proxy Namespaces config~config Modules baseProxyclicommandsconfigglobalProxyhelphttpProxyindexinteractiveloggermiddleware/cachemiddleware/indexmiddleware/infomiddleware/reqBodymiddleware/resHeadersmiddleware/speedsteps Classes baseProxy~BaseProxycommands~CommandsglobalProxy~GlobalProxyhttpProxy~HttpProxy Mixin: module:steps module:steps Steps to manage proxy. Source: steps.js, line 20 Methods &lt;protected&gt; _checkProxy() Helper to check that proxy is launched. Source: steps.js, line 417 Throws: If no proxy is launched. Type AssertionError disableCache() Step to disable cache. Source: steps.js, line 404 enableCache() Step to enable cache. Source: steps.js, line 393 getProxyUrl( [opts]) Step to get proxy URL. Parameters: Name Type Argument Description opts object &lt;optional&gt; Step options. Properties Name Type Argument Default Description check boolean &lt;optional&gt; true Flag to check that proxy URL is defined. Source: steps.js, line 85 Throws: If proxy URL isn't defined. Type AssertionError getResponsesData( [opts]) Step to get measured responses data. Parameters: Name Type Argument Description opts object &lt;optional&gt; Step options. Properties Name Type Argument Default Description check boolean &lt;optional&gt; true Flag to check that responses data are present. Source: steps.js, line 327 Throws: If responses data are absent. Type AssertionError limitProxySpeed(speed [, opts]) Step to limit proxy speed. Parameters: Name Type Argument Description speed number Proxy limited speed, kb/s. opts object &lt;optional&gt; Step options. Properties Name Type Argument Default Description check boolean &lt;optional&gt; true Flat to check that proxy speed is limited. Source: steps.js, line 220 Throws: If proxy speed is not limited. Type AssertionError measureResponses( [opts]) Step to start responses measurement. Parameters: Name Type Argument Description opts object &lt;optional&gt; Step options. Properties Name Type Argument Default Description check boolean &lt;optional&gt; true Flag to check that responses measurement is launched. Source: steps.js, line 290 Throws: If responses measurement is not launched. Type AssertionError &lt;async&gt; startGlobalProxy( [opts]) Step to start global proxy. Step recall will be skipped if global proxy wasn't stopped before. Parameters: Name Type Argument Description opts object &lt;optional&gt; Step options. Properties Name Type Argument Default Description useCache boolean &lt;optional&gt; Flag to use proxy cache for responses. Default value will be requested from config.useCache if it is specified. timeout number &lt;optional&gt; Proxy timeout to break connection. Default value will be requested from config.timeout.proxy. reconnect number &lt;optional&gt; Number of proxy reconnects on failure. port number &lt;optional&gt; Proxy port. Default value will be requested from config.globalProxyPort. check boolean &lt;optional&gt; true Flag to check that proxy was launched. Source: steps.js, line 148 Throws: If global proxy was not launched. Type AssertionError &lt;async&gt; startProxy( [opts]) Step to start proxy. Step recall will be skipped if proxy wasn't stopped before. Parameters: Name Type Argument Description opts object &lt;optional&gt; Step options. Properties Name Type Argument Default Description appUrl string &lt;optional&gt; Web application url which will be proxied. Default value will be requested from config.appUrl if it is specified. useCache boolean &lt;optional&gt; Flag to use proxy cache for responses. Default value will be requested from config.useCache if it is specified. timeout number &lt;optional&gt; Proxy timeout to break connection. Default value will be requested from config.timeout.proxy. reconnect number &lt;optional&gt; Number of proxy reconnects on failure. port number &lt;optional&gt; Proxy port. Default value will be requested from config.proxyPort. check boolean &lt;optional&gt; true Flag to check that proxy was launched. Source: steps.js, line 44 Throws: If proxy was not launched. Type AssertionError Returns: Proxied URL. Type Promise.&lt;string&gt; &lt;async&gt; stopGlobalProxy( [opts]) Step to stop global proxy. Step call will be skipped if global proxy wasn't launched before. Parameters: Name Type Argument Description opts object &lt;optional&gt; Step options. Properties Name Type Argument Default Description check boolean &lt;optional&gt; true Flag to check that global proxy was stopped. Source: steps.js, line 191 Throws: If global proxy wasn't stopped. Type AssertionError &lt;async&gt; stopProxy( [opts]) Step to stop proxy. Step call will be skipped if proxy wasn't launched before. Parameters: Name Type Argument Description opts object &lt;optional&gt; Step options. Properties Name Type Argument Default Description check boolean &lt;optional&gt; true Flag to check that proxy was stopped. Source: steps.js, line 108 Throws: If proxy wasn't stopped. Type AssertionError unlimitProxySpeed( [opts]) Step to unlimit proxy speed. Parameters: Name Type Argument Description opts object &lt;optional&gt; Step options. Properties Name Type Argument Default Description check boolean &lt;optional&gt; true Flag to check that proxy speed is unlimited. Source: steps.js, line 255 Throws: If proxy speed is still limited. Type AssertionError unmeasureResponses( [opts]) Step to stop responses measurement. Parameters: Name Type Argument Description opts object &lt;optional&gt; Step options. Properties Name Type Argument Default Description check boolean &lt;optional&gt; true Flag to check that responses measurement is stopped. Source: steps.js, line 360 Throws: If responses measurement is still running. Type AssertionError × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
